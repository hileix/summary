# power-works 项目

power-works 是一个面向企业开箱既用的解决方案。

- 采用 `iframe 的微前端架构`。`微前端` 架构的优点：

  - 技术栈无关。主框架不限制接入应用的技术栈，子应用具备完全自主权。
  - 独立开发、独立部署以及子应用仓库独立。前后端可独立开发，部署完成后主框架自动完成同步更新。
  - 独立运行时。每个子应用之间状态隔离，运行时状态不共享。

- 基于 `antd` ui 组件库：

  - `data` 组件：基于 `antd` 开发了很多与业务数据相关的组件，如 `TableData` 组件，封装了许多如请求表格数据等操作。
  - `ui` 组件：基于 `antd` 开发了很多更为复杂的 ui 组件。
  - `hoc` 高阶组件：将一些通用的逻辑、视图代码编封装成高阶组件。

- 页面可配置。企业内部大多数使用表格、表单的形式展现页面，初级前端开发人员可以通过简单的配置实现页面。

将通用的页面组件抽离出来，形成单独的 npm 库，在使用时，直接引入然后配置即可。

- 页面可定制。

写定制的页面组件，然后引入使用即可。

## 1. power-works 架构

power-works 采用的 `微前端` 的架构，`微前端` 的架构带来的好处在上面已经提过了，但 `微前端` 在 power-works 带来最大的价值还是第二点：`独立开发、独立部署`。

## 2. power works 面临的问题

在 power works 刚开始开发的时候，页面模块并不是很多。这个时候，pw 还只是一个简单的单体应用，这种复杂度的应用，最开始的架构足以支撑开发。

但随着功能模块页面的越来越多，逐渐会产生以下问题：

- 打包应用时间太长
- 每个功能模块不能单独开发
- 每个功能模块不能单独部署

## 3. 解决方案

### 3.1 打包时间太长的解决方案

- Webpack 优化

  主要是通过 dll 的优化，将一些不太会经常更新的模块（如：react/react-dom/redux 等）提前打包好，然后通过 Webpack 的 dll 插件进行引入。

  其他的一些优化方式，也试过（如：happy-pack 等），但效果不理想。

- 功能模块拆分

Webpack 的优化只能起到一部分的优化作用。因为随着功能模块的越来越多，业务代码也会越来越多。这个 Webpack 的打包时间也会越来越慢。

这个时候，我们可以将每个功能模块拆分成独立的应用，每个独立的应用都可以进行独立开发和独立部署。

### 3.2 每个功能模块不能单独开发的解决方案

由于每个模块，都是应用的一部分，所以会导致开发时，必须启动整个应用，所以每个功能模块不能单独进行开发。

但因为每个功能模块，都是通过路由来访问的（即一个功能对应一个路由），这个时候，我们就可以通过 iframe 的方式来实现功能模块的拆分。

这个时候，我们每加载一个应用，都会使用 iframe 来承载该功能模块。通过 iframe 加载的模块，也就可以将项目拆分出去了。iframe 加载的的是一个路由，这个路由在后端可以配置成当前端访问了该路由时，将这个路由的模块的静态资源返回给前端，前端就会进行渲染。

### 3.3 每个功能模块不能单独部署的解决方案

解决了 `每个功能模块不能单独开发` 不能单独开发的问题后，就自然而然的就解决了 `每个功能模块不能单独部署` 的问题了。

每个功能模块在单独开发之后，就可以进行单独部署了。

## 4. 反思：更好的解决方案

上面提到了的方案，可以称之为 `微前端架构`，是使用 `iframe` 实现的。

使用 `iframe` 实现的微前端架构，会带来以下缺点：

- 用户体验不好
- [更多...](https://www.yuque.com/kuitos/gky7yw/gesexv)

更好的解决方案：使用目前市面上的一些 `微前端架构` 的框架，如 [qiankun](https://qiankun.umijs.org/zh/guide),[single-spa](https://github.com/CanopyTax/single-spa) 等。

这种 `微前端框架`，体验会更好。
