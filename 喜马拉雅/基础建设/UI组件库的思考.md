# UI 组件库的思考

cat-ui 组件库，是喜马拉雅海外前端部门编写的一套 UI 组件库，基于 React。

- 使用 storybook 搭建 UI 组件库的开发环境。且使用 storybook 的插件，将其部署到 github pages 中，能查看 UI 组件库的文档
- 内部含有 34 个常用的 UI 组件，测试覆盖率达到 92%
- 支持通过配置 `babel-plugin-import` 插件可以实现组件的按需加载

## UI 组件库开发的思考

### 1. 如何搭建一个 UI 组件库

搭建一个 UI 组件库，需要考虑一下问题：

- 在开发层面，需要解决以下问题

  - 选择 typescript 还是 javascript
  - 开发环境如何搭建
  - 组件库目录结构该如何设计
  - CSS 方案如何选择，以及如何保证项目中使用其他组件库时样式不会互相干扰
  - 组件库如何打包

- 在用户层面，需要解决以下问题

  - 组件库如何使用
  - 如何查看组件库文档
  - 如何更新组件库

#### 1.1 选择 typescript 还是 javascript？

如今 typescript 越来越流行，虽然 javascript 发展的也越来越好，但由于是动态语言，缺少静态类型的检查，出现类型或语法错误时，编辑器不能及时提示出错误信息，只能在编译完后提示错误，开发体验略差。

而且提供给用户使用的组件，若使用 js 写组件库，就没有类型定义文件。为了让使用 ts 在使用组件库时能得到更好的类型提示，我们（或用户）必须自己写好定义文件。而如果直接使用 ts，ts 在编译后可以直接生成类型定义文件，非常方便。

综合以上，我们选择 typescript 开发 UI 组件库。

#### 1.2 开发环境如何搭建

在开发环境中，开发者可以开发、调试 UI 组件。cat-ui 使用的是 [storybook](https://github.com/storybookjs/storybook/)进行开发环境的搭建。

#### 1.3 组件库结构该如何设计

每个组件应该是独立的，所以每个组件放在一个文件夹内，并且和该组件相关的所有资源都放在这个文件夹内。

#### 1.4 CSS 方案如何选择，以及如何保证项目中的样式和组件库的样式不会互相干扰

我们采用 SCSS + BEM 命名法规范，来写组件的 CSS。在使用 BEM 命名法时，我们会在使用 CSS 的 class 时，加上 `cat-ui` 的前缀，这样组件库有了 `cat-ui` 的命名空间后，就不会与项目中的其他样式互相干扰了。

#### 1.5 组件库如何打包

使用 `tsc` 命令进行打包。

#### 1.6 组件库如何使用

##### 1.6.1 模块化导入使用

在模块化导入使用时，一般都会使用打包工具对项目进行打包，如 `webpack`。

```js
import { Button } from 'cat-ui';
```

上面导入了 Button 组件，这个时候，CSS 该如何导入？有两种方式：

1. 全局导入组件的样式
   全局导入组件的样式，会导致首屏渲染时，会导入所有使用的组件的样式文件。在本页面中，不会用到所有的组件，没必要在全局导入组件的样式。
2. 在本页面导入组件的样式
   在本页面按需导入组件样式，只导入使用到的组件的样式。这个时候，我们需要在 `import { Button } from 'cat-ui';` 时，就自动导入 `Button` 组件对应的 css 文件。我们可以通过 `babel-import-plugin` 插件来实现。通过该插件也可以实现按需导入组件。

##### 1.6.2 通过 script 和 link 标签使用组件库

如果需要以 script 和 link 标签导入组件和组件样式，就需要将组件打包成单个 js 和 css 文件，然后提供给用户下载。我们没有使用到这种方式，所有没有提供该打包方式。

#### 1.7 如何查看组件库文档

通过 storybook 的插件，可以将项目打包并且发布到 github pages，在 github pages 上就可以查看组件库的文档了。

#### 1.8 如何更新组件库

组件库需要严格遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

组件库必须提供每次版本变更时的变更日志，让用户能够从日志中了解组件库更新了什么东西。

### 2. 组件设计的基本原则

- 单一职责
  表示组件只做一件事。单一职责可以保证组件是最细粒度的，有利于复用。
- 通用性
  避免代码重复。当重复两次及以上的代码时，可以考虑一下是否可以提取成通用的组件。
- 可扩展性
  组件的有些部分是可以扩展的，比如说按钮的前缀和后缀。这样在不同的需求中，可以通过扩展的 props，能够实现更多的需求。可扩展性可以让组件能适应更多的需求场景。
- 组合
  组件也是可以相互组合的。组合起来可以实现更加强大的功能。
